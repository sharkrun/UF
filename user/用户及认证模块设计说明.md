# 用户及认证模块

## 用户模块

用户模块管理用户账号信息,提供用户账号查询，增加，修改，删除操作。

用户账号数据结构包括：
* 用户id: 随机生成uuid
* 用户名：英文+数字字符串
* 密码：sha256加密
* email：用户邮箱
* 昵称：可用于内部显示用的昵称
* 账号注册时间：账号在系统内的创建时间
* 最近一次登录时间：最近一次登录的时间
* 激活状态：是否激活处于使用状态
* 有效状态：账户是否有效，标记删除所使用
* 是否超级管理员：是否是系统管理员上
* 用户认证方式：认证类型

## 用户模块操作及操作权限

### 用户查询

当操作者权限为超级管理员，可查询到系统内的全部用户信息。

当操作者非超级管理员，仅能查询到自身用户信息。

当无认证信息，禁止此操作。

### 用户添加

当操作者权限为超级管理员，若当前认证方式为 local，即可以添加用户；若当前认证方式为ldap，禁止操作。

当操作者非超级管理员，禁止此操作。

当无认证信息，若当前认证方式为 local，可创建非超级管理员的用户，若当前认证方式为ldap，禁止操作。

### 用户删除

当操作者权限为超级管理员，可标记非自身的用户为无效，即删除状态。

其他权限，禁止此操作

### 用户修改

当操作者权限为超级管理员，可修改任意用户的部分信息，与系统相关的部分信息禁止修改。

当操作者非超级管理员，仅能修改自身部分信息。

当无认证信息，禁止此操作。

### 用户激活及反激活

当操作者权限为超级管理员，可激活或反激活非自身的用户，反激活后，用户将无法登录，不会进行用户登录认证操作。

其他权限，禁止此操作。

### 用户登录

用户使用用户名和密码或邮箱和密码进行登录操作。

当认证方式为local，系统检索认证方式为local的用户账户信息，判定登录密码是否正确。当认证方式为ldap，通过远端ldap服务器检查用户名和密码的正确性，判定登录是否正确。

当认证方式为local，登录判定成功，更新登录时间。当认证方式为ldap，登录判定成功，检索系统内是否已有此账号信息，若无信息，则创建对应的用户并保存，若有，更新登录时间。

当登录成功，生成一个唯一token uuid，并返回。token用于用作后续的鉴权使用，可以由前端持有并在每次api调用时使用。token有效时间为600秒，并且在每次鉴权操作时更新。若无鉴权操作，超时后token会被系统删除而失效。

### 用户登出

根据用户token，清理相应token，完成用户登出。

### 用户鉴权

根据具体token，查询用户信息。

## 认证模块

认证模块保存系统认证方式，提供认证方式修改，具体认证机制的系统配置。现认证方式为 local, ldap 两种支持。

对于ldap认证，保存认证配置的服务器及端口，管理员用户名密码，属性标签，认证查询字串等。

### 操作权限

当操作者权限为超级管理员，可修改认证方式，可修改 ldap 服务配置信息。查询认证方式，查询 ldap 服务配置信息，测试 ldap 操作，均无需登录或权限要求。

## 工作模式

针对普通用户，账号随着认证模式的不同而使用不同类型的账号。当认证方式为 local，登录和查询操作均会仅能操作认证类型为local的账号；当认证方式为 ldap，每次登录均会使用 ldap 服务器进行密码校验，因此能登录也仅为 ldap 上的用户。

针对超级管理员，无论认证模式为何种，均可以使用。当认证方式为 local，类型为 local 的超级管理员，能够认证成功，因此可以以管理员身份登录操作；类型为 ldap 的超级管理员，由于无法进行 ldap 认证，无法认证成功，因此无法登录操作。当认证方式为 ldap，类型为 local 的超级管理员，能够认证成功；类型为 ldap 的超级管理员，也可以认证成功，因此均能以管理员身份登录操作。
